<!doctype html>
<html>
<head>
  <title>TwinSpark.js docs</title>
  <link rel="stylesheet" href="vendor/spectre.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="vendor/fetch-mock.js"></script>
  <script src="twinspark.js"></script>
  <script>
    function prev() { return document.currentScript.previousElementSibling.innerText; }

    function escape(s) {
      return s
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function trim(s) {
      return s.replace(/^\n+|\s+$/g, '')
    }

    document.addEventListener('DOMContentLoaded', function() {
      [].forEach.call(document.querySelectorAll('.card'), function(el) {
        var example = el.querySelector('.card-body');
        example.initial = example.innerHTML;
        el.querySelector('.reset').addEventListener('click', function(e) {
          example.innerHTML = example.initial;
          twinspark._internal.init();
        });
        el.querySelector('.source').addEventListener('click', function(e) {
          example.innerHTML = '<pre><code>' +
                              escape(trim(example.initial)) +
                              '</code></pre>';
        });
      });

      [].forEach.call(document.querySelectorAll('h3'), function(el) {
        if (el.id) {
          var a = document.createElement('a');
          a.href = '#' + el.id;
          a.innerText = '#';
          el.append(' ');
          el.append(a);
        }
      });
    });
  </script>
  <style>
    body {padding-bottom: 3em;} /* until we get footer? */
    .card-body {overflow: scroll; }
    .btn-sm {margin-bottom: .2rem; }
  </style>
</head>
<body class="container">
<div class="columns">
<div class="column col-6 col-xl-8 col-lg-10 col-md-12 col-mx-auto">

<h1><a href="/">TwinSpark</a></h1>
<ul>
  <li>Dual ignition engines from Alfa Romeo, used from 1914 in Grand Prix cars to 2009.</li>
  <li>Declarative enhancement for HTML: simple, composable, lean.</li>
</ul>

<p>TwinSpark was heavily influenced
  by <a href="https://intercoolerjs.org/">Intercooler</a> and the main reasons
  for existing are following:</p>
<ul>
  <li>Intercooler limited (and I don't mean in a bad sense) extensibility meant
    there is no way to implement analytics.</li>
  <li>There is no (official) way to update few fragments at the same time.</li>
  <li>As a related problem, there is no way to batch few requests into a single
    one, and our architecture makes that pretty important.</li>
  <li>jQuery. It is 2020 on the streets already, can we just drop that?</li>
</ul>

<hr>

<h2>Guide</h2>

<h3 id="fragment">Fragment updating</h3>
<p>The core feature of TwinSpark.js is it's ability to update fragments of the
  page using AJAX requests to server without writing JavaScript.</p>
<p>To simplify inner logic you have one limitation - you can only return single
  element from the server. If you return more, they will be ignored. How to deal
  with that and why it is so - read on.</p>


<div class="card">
  <div class="card-header">
    <h5 class="d-inline mr-2">Demo</h5>
    <button class="btn btn-link btn-sm reset">Reset</button>
    <button class="btn btn-link btn-sm source">View Source</button>
  </div>

  <p class="card-body">
    <a href="/req" ts-req>Update me</a>
  </p>

  <script type="text/html">
    <a href="/req" ts-req>Updated!</a>
  </script>
  <script>
    fetchMock.get("/req", prev());
  </script>
</div>


<h3 id="trigger" class="mt-2">Triggering requests</h3>
<p>Usually requests are triggered on natural interrupts: submit on forms and
  clicks elsewhere, but sometimes you want more, like triggering on being seen
  or hovered:</p>

<div class="card">
  <div class="card-header">
    <h5 class="d-inline mr-2">Demo</h5>
    <button class="btn btn-link btn-sm reset">Reset</button>
    <button class="btn btn-link btn-sm source">View Source</button>
  </div>

  <p class="card-body">
    <a href="/trigger" ts-req ts-trigger="mouseenter">Hover me!</a>
  </p>

  <script type="text/html">
    <a href="/trigger" ts-req>Good girl! :)</a>
  </script>
  <script>
    fetchMock.get("/trigger", prev());
  </script>
</div>


<h3 id="target" class="mt-2">Targeting other elements</h3>
<p>Often you don't want to replace clicked element, but some other part of the
  page, like if you hit "Refresh" and need to update big part of the page. This
  can be done with <code>ts-target</code> attribute, which takes a CSS
  selector.</p>

<div class="card">
  <div class="card-header">
    <h5 class="d-inline mr-2">Demo</h5>
    <button class="btn btn-link btn-sm reset">Reset</button>
    <button class="btn btn-link btn-sm source">View Source</button>
  </div>

  <p class="card-body">
    <span id="target">I'm waiting...</span>
    <a href="/target" ts-req ts-target="#target">Do it!</a>
  </p>

  <script type="text/html">
    <span id="target">Good catch!</span>
  </script>
  <script>
    fetchMock.get("/target", prev());
  </script>
</div>


<h3 id="parent" class="mt-2">Targeting parents</h3>
<p>Interestingly, this seems like the most common pattern - when a button needs
  to update an element around itself. Add modifier <code>parent</code> before
  selector and <code>element.closest(selector)</code> method will be used to
  find a parent. This will help a lot to minimize amount of ids.</p>

<div class="card">
  <div class="card-header">
    <h5 class="d-inline mr-2">Demo</h5>
    <button class="btn btn-link btn-sm reset">Reset</button>
    <button class="btn btn-link btn-sm source">View Source</button>
  </div>

  <div class="card-body">
    <p>Wanna read text behind me?
      <a href="/closest" ts-req ts-target="parent p">Do it!</a>
    </p>
  </div>

  <script type="text/html">
    <p>Did you know that introducing too many ids is a symptom of coupling
      logic with markup?</p>
  </script>
  <script>
    fetchMock.get("/closest", prev());
  </script>
</div>


<h3 id="indicator" class="mt-2">Indicating activity</h3>
<p>It's really irritating when you click a link and nothing happens for some time. Luckily
  TwinSpark makes it really easy: it adds class <code>ts-active</code> to an element, enhanced with <code>ts-req</code>.</p>

<div class="card">
  <div class="card-header">
    <h5 class="d-inline mr-2">Demo</h5>
    <button class="btn btn-link btn-sm reset">Reset</button>
    <button class="btn btn-link btn-sm source">View Source</button>
  </div>

  <p class="card-body">
    <a href="/indicator" class="indicator" ts-req>Just click me</a>
  </p>

  <style>
    .indicator.ts-active {
      min-height: .8rem;
      pointer-events: none;
      position: relative;
    }
    .indicator.ts-active::after {
      animation: loading .5s infinite linear;
      border: .1rem solid #5755d9;
      border-radius: 50%;
      border-right-color: transparent;
      border-top-color: transparent;
      content: "";
      display: block;
      height: .8rem;
      left: 110%;
      margin-left: -.4rem;
      margin-top: -.4rem;
      position: absolute;
      top: 50%;
      width: .8rem;
      z-index: 1;
    }
  </style>

  <script type="text/html">
    <a href="/indicator" class="indicator" ts-req>Just click me</a>
  </script>
  <script>
    (function(markup) {
      fetchMock.get("/indicator", function() {
        return new Promise(res => setTimeout(res, 1000, markup))
      });
    })(prev());
  </script>
</div>


<h3 id="actions" class="mt-2">Actions</h3>
<p>Sometimes you don't need to go to server to do something. Closing popup or
  hiding an element can be done without network round trip.</p>


<div class="card">
  <div class="card-header">
    <h5 class="d-inline mr-2">Demo</h5>
    <button class="btn btn-link btn-sm reset">Reset</button>
    <button class="btn btn-link btn-sm source">View Source</button>
  </div>

  <div class="card-body">
    <p>
      Hey! I'm here!
      <button class="btn" ts-action="remove" ts-trigger="click" ts-target="parent p">Remove me!</button>
    </p>
  </div>
</div>


<div class="card">
  <div class="card-header">
    <h5 class="d-inline mr-2">Demo</h5>
    <button class="btn btn-link btn-sm reset">Reset</button>
    <button class="btn btn-link btn-sm source">View Source</button>
  </div>

  <div class="card-body">
    <p ts-target="child span">
      <span>Remove with timeout</span>
      <button class="btn" ts-action="addClass loading, delay 1000, remove" ts-trigger="click">Do it!</button>
    </p>
  </div>
</div>
